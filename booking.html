<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reservar Cita - Peluquer√≠a Mar√≠a</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui; background: #f8fafc; }
        .header { background: white; padding: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; }
        .header h1 { color: #1e40af; margin-bottom: 0.5rem; }
        .header p { color: #6b7280; }
        .container { max-width: 800px; margin: 0 auto; padding: 2rem; }
        .step { background: white; border-radius: 12px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .step h3 { color: #374151; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .step-number { background: #1e40af; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.875rem; }
        .services-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
        .service-card { border: 2px solid #e2e8f0; border-radius: 8px; padding: 1rem; cursor: pointer; transition: all 0.3s; }
        .service-card:hover { border-color: #1e40af; }
        .service-card.selected { border-color: #1e40af; background: #eff6ff; }
        .service-card h4 { color: #374151; margin-bottom: 0.5rem; }
        .service-card .duration { color: #6b7280; font-size: 0.875rem; }
        .service-card .price { color: #1e40af; font-weight: 600; margin-top: 0.5rem; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1rem; margin-bottom: 2rem; }
        .calendar-day { border: 2px solid #e2e8f0; border-radius: 8px; padding: 1rem; text-align: center; cursor: pointer; transition: all 0.3s; }
        .calendar-day:hover { border-color: #1e40af; }
        .calendar-day.selected { border-color: #1e40af; background: #eff6ff; }
        .calendar-day.disabled { opacity: 0.3; cursor: not-allowed; }
        .times-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 1rem; }
        .time-slot { border: 2px solid #e2e8f0; border-radius: 8px; padding: 0.75rem; text-align: center; cursor: pointer; transition: all 0.3s; }
        .time-slot:hover { border-color: #1e40af; }
        .time-slot.selected { border-color: #1e40af; background: #eff6ff; }
        .time-slot.unavailable { background: #fef2f2; border-color: #fecaca; color: #ef4444; cursor: not-allowed; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 500; }
        .form-group input { width: 100%; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 8px; }
        .btn { background: #10b981; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-size: 1rem; width: 100%; }
        .btn:hover { background: #059669; }
        .btn:disabled { background: #9ca3af; cursor: not-allowed; }
        .summary { background: #f0f9ff; border: 2px solid #0ea5e9; border-radius: 8px; padding: 1rem; margin-bottom: 2rem; }
        .summary h4 { color: #0c4a6e; margin-bottom: 0.5rem; }
        .summary-item { display: flex; justify-content: space-between; margin-bottom: 0.25rem; }
        .hidden { display: none; }
        .debug { background: #fef3c7; border: 1px solid #f59e0b; padding: 1rem; margin: 1rem 0; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚úÇÔ∏è Peluquer√≠a Mar√≠a</h1>
        <p>Reserva tu cita online de forma r√°pida y sencilla</p>
    </div>
    
    <div class="container">
        <!-- Debug Info -->
        <div class="debug" id="debugInfo" style="display: none;">
            <h4>üêõ Debug Info</h4>
            <div id="debugText"></div>
        </div>
        
        <!-- Paso 1: Seleccionar Servicio -->
        <div class="step" id="step1">
            <h3><span class="step-number">1</span> Selecciona tu servicio</h3>
            <div class="services-grid" id="servicesGrid">
                <!-- Generated by JavaScript -->
            </div>
        </div>
        
        <!-- Paso 2: Seleccionar Fecha -->
        <div class="step hidden" id="step2">
            <h3><span class="step-number">2</span> Elige la fecha</h3>
            <div class="calendar-grid" id="calendarGrid">
                <!-- Generated by JavaScript -->
            </div>
        </div>
        
        <!-- Paso 3: Seleccionar Hora -->
        <div class="step hidden" id="step3">
            <h3><span class="step-number">3</span> Selecciona la hora</h3>
            <div class="times-grid" id="timesGrid">
                <!-- Generated by JavaScript -->
            </div>
        </div>
        
        <!-- Paso 4: Datos del Cliente -->
        <div class="step hidden" id="step4">
            <h3><span class="step-number">4</span> Tus datos</h3>
            
            <div class="summary">
                <h4>üìã Resumen de tu reserva</h4>
                <div class="summary-item"><span>Servicio:</span> <span id="summaryService">-</span></div>
                <div class="summary-item"><span>Fecha:</span> <span id="summaryDate">-</span></div>
                <div class="summary-item"><span>Hora:</span> <span id="summaryTime">-</span></div>
                <div class="summary-item"><span>Duraci√≥n:</span> <span id="summaryDuration">-</span></div>
                <div class="summary-item"><span><strong>Precio:</strong></span> <span id="summaryPrice"><strong>-</strong></span></div>
            </div>
            
            <div class="form-group">
                <label for="clientName">Nombre completo *</label>
                <input type="text" id="clientName" required placeholder="Ej: Mar√≠a Garc√≠a">
            </div>
            
            <div class="form-group">
                <label for="clientPhone">Tel√©fono *</label>
                <input type="tel" id="clientPhone" required placeholder="Ej: 666 777 888">
            </div>
            
            <div class="form-group">
                <label for="clientEmail">Email (opcional)</label>
                <input type="email" id="clientEmail" placeholder="Ej: maria@gmail.com">
            </div>
            
            <div class="form-group">
                <label for="clientNotes">Comentarios (opcional)</label>
                <input type="text" id="clientNotes" placeholder="Alguna petici√≥n especial...">
            </div>
            
            <button class="btn" onclick="confirmBooking()">
                ‚úÖ Confirmar Reserva
            </button>
        </div>
    </div>

    <script>
        let selectedService = null;
        let selectedDate = null;
        let selectedTime = null;
        
        // Configuraci√≥n por defecto
        const defaultSchedule = {
            'Lunes': { active: true, openTime: '09:00', closeTime: '18:00' },
            'Martes': { active: true, openTime: '09:00', closeTime: '18:00' },
            'Mi√©rcoles': { active: true, openTime: '09:00', closeTime: '18:00' },
            'Jueves': { active: true, openTime: '09:00', closeTime: '18:00' },
            'Viernes': { active: true, openTime: '09:00', closeTime: '18:00' },
            'S√°bado': { active: true, openTime: '09:00', closeTime: '15:00' },
            'Domingo': { active: false, openTime: '00:00', closeTime: '00:00' }
        };
        
        const defaultServices = [
            { name: 'Corte', duration: 30, price: 15 },
            { name: 'Tinte', duration: 90, price: 45 },
            { name: 'Mechas', duration: 120, price: 65 },
            { name: 'Lavado + Peinado', duration: 45, price: 20 },
            { name: 'Tratamiento', duration: 60, price: 35 }
        ];
        
        function debugLog(message) {
            console.log('üêõ BOOKING DEBUG:', message);
            const debugInfo = document.getElementById('debugInfo');
            const debugText = document.getElementById('debugText');
            debugInfo.style.display = 'block';
            debugText.innerHTML += '<div>' + message + '</div>';
        }
        
        // Cargar servicios del negocio
        function loadServices() {
            const services = JSON.parse(localStorage.getItem('businessServices') || JSON.stringify(defaultServices));
            debugLog('Servicios cargados: ' + services.length);
            
            const grid = document.getElementById('servicesGrid');
            grid.innerHTML = '';
            
            services.forEach((service, index) => {
                const card = document.createElement('div');
                card.className = 'service-card';
                card.onclick = () => selectService(service, card);
                
                card.innerHTML = `
                    <h4>${service.name}</h4>
                    <div class="duration">${service.duration} minutos</div>
                    <div class="price">‚Ç¨${service.price}</div>
                `;
                
                grid.appendChild(card);
            });
        }
        
        function selectService(service, element) {
            // Remover selecci√≥n anterior
            document.querySelectorAll('.service-card').forEach(card => card.classList.remove('selected'));
            element.classList.add('selected');
            
            selectedService = service;
            debugLog('Servicio seleccionado: ' + service.name);
            showStep(2);
            generateCalendar();
        }
        
        function generateCalendar() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            const today = new Date();
            const schedule = JSON.parse(localStorage.getItem('businessSchedule') || JSON.stringify(defaultSchedule));
            debugLog('Horarios cargados: ' + Object.keys(schedule).length + ' d√≠as');
            
            // Generar pr√≥ximos 14 d√≠as
            for (let i = 0; i < 14; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                const dayName = date.toLocaleDateString('es-ES', { weekday: 'long' });
                const dayNameKey = dayName.charAt(0).toUpperCase() + dayName.slice(1);
                const isWorkingDay = schedule[dayNameKey]?.active !== false;
                
                const dayDiv = document.createElement('div');
                dayDiv.className = `calendar-day ${!isWorkingDay ? 'disabled' : ''}`;
                
                if (isWorkingDay) {
                    dayDiv.onclick = () => selectDate(date, dayDiv);
                }
                
                dayDiv.innerHTML = `
                    <div style="font-weight: 600;">${date.getDate()}</div>
                    <div style="font-size: 0.75rem; color: #6b7280;">${date.toLocaleDateString('es-ES', { weekday: 'short' })}</div>
                `;
                
                grid.appendChild(dayDiv);
            }
        }
        
        function selectDate(date, element) {
            document.querySelectorAll('.calendar-day').forEach(day => day.classList.remove('selected'));
            element.classList.add('selected');
            
            selectedDate = date;
            debugLog('Fecha seleccionada: ' + date.toLocaleDateString('es-ES'));
            showStep(3);
            generateTimeSlots();
        }
        
        function generateTimeSlots() {
            const grid = document.getElementById('timesGrid');
            grid.innerHTML = '';
            
            const schedule = JSON.parse(localStorage.getItem('businessSchedule') || JSON.stringify(defaultSchedule));
            const appointments = JSON.parse(localStorage.getItem('appointments') || '[]');
            
            const dayName = selectedDate.toLocaleDateString('es-ES', { weekday: 'long' });
            const dayNameKey = dayName.charAt(0).toUpperCase() + dayName.slice(1);
            const daySchedule = schedule[dayNameKey];
            
            debugLog('Generando horarios para: ' + dayNameKey);
            debugLog('Configuraci√≥n del d√≠a: ' + JSON.stringify(daySchedule));
            
            if (!daySchedule || !daySchedule.active) {
                debugLog('D√≠a no activo');
                grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #ef4444;">Este d√≠a no est√° disponible</p>';
                return;
            }
            
            const openTime = daySchedule.openTime;
            const closeTime = daySchedule.closeTime;
            const serviceDuration = selectedService.duration;
            
            debugLog(`Horario: ${openTime} - ${closeTime}, Servicio: ${serviceDuration}min`);
            
            // Generar slots cada 30 minutos
            const slots = [];
            let currentTime = openTime;
            
            while (currentTime < closeTime) {
                const endTime = addMinutes(currentTime, serviceDuration);
                if (endTime <= closeTime) {
                    const isAvailable = checkAvailability(selectedDate, currentTime, serviceDuration, appointments);
                    slots.push({ time: currentTime, available: isAvailable });
                }
                currentTime = addMinutes(currentTime, 30);
            }
            
            debugLog('Slots generados: ' + slots.length);
            
            if (slots.length === 0) {
                grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #ef4444;">No hay horarios disponibles para este d√≠a</p>';
                return;
            }
            
            slots.forEach(slot => {
                const timeDiv = document.createElement('div');
                timeDiv.className = `time-slot ${!slot.available ? 'unavailable' : ''}`;
                timeDiv.textContent = slot.time;
                
                if (slot.available) {
                    timeDiv.onclick = () => selectTime(slot.time, timeDiv);
                }
                
                grid.appendChild(timeDiv);
            });
        }
        
        function selectTime(time, element) {
            document.querySelectorAll('.time-slot').forEach(slot => slot.classList.remove('selected'));
            element.classList.add('selected');
            
            selectedTime = time;
            debugLog('Hora seleccionada: ' + time);
            updateSummary();
            showStep(4);
        }
        
        function updateSummary() {
            document.getElementById('summaryService').textContent = selectedService.name;
            document.getElementById('summaryDate').textContent = selectedDate.toLocaleDateString('es-ES');
            document.getElementById('summaryTime').textContent = selectedTime;
            document.getElementById('summaryDuration').textContent = selectedService.duration + ' min';
            document.getElementById('summaryPrice').textContent = '‚Ç¨' + selectedService.price;
        }
        
        function confirmBooking() {
            const name = document.getElementById('clientName').value;
            const phone = document.getElementById('clientPhone').value;
            
            if (!name || !phone) {
                alert('Por favor completa los campos obligatorios');
                return;
            }
            
            const booking = {
                id: Date.now().toString(),
                client: name,
                phone: phone,
                email: document.getElementById('clientEmail').value,
                service: selectedService.name,
                duration: selectedService.duration,
                price: selectedService.price,
                date: selectedDate.toISOString().split('T')[0],
                time: selectedTime,
                status: 'pending',
                notes: document.getElementById('clientNotes').value,
                createdAt: new Date().toISOString(),
                source: 'public_booking'
            };
            
            // Guardar en localStorage (en producci√≥n ser√≠a una API)
            const appointments = JSON.parse(localStorage.getItem('appointments') || '[]');
            appointments.push(booking);
            localStorage.setItem('appointments', JSON.stringify(appointments));
            
            debugLog('Reserva guardada: ' + booking.id);
            
            // Mostrar confirmaci√≥n
            alert(`‚úÖ ¬°Reserva realizada con √©xito!

üìã Detalles:
‚Ä¢ Cliente: ${name}
‚Ä¢ Servicio: ${selectedService.name}
‚Ä¢ Fecha: ${selectedDate.toLocaleDateString('es-ES')}
‚Ä¢ Hora: ${selectedTime}
‚Ä¢ Precio: ‚Ç¨${selectedService.price}

üì± Recibir√°s confirmaci√≥n por WhatsApp/SMS
‚ö†Ô∏è Tu cita est√° PENDIENTE de confirmaci√≥n por el negocio`);
            
            // Reset form
            location.reload();
        }
        
        // Utility functions
        function addMinutes(time, minutes) {
            const [hours, mins] = time.split(':').map(Number);
            const date = new Date();
            date.setHours(hours, mins + minutes, 0, 0);
            return date.getHours().toString().padStart(2, '0') + ':' + 
                   date.getMinutes().toString().padStart(2, '0');
        }
        
        function checkAvailability(date, time, duration, appointments) {
            const dateStr = date.toISOString().split('T')[0];
            return !appointments.some(apt => 
                apt.date === dateStr && 
                apt.time === time && 
                apt.status !== 'cancelled'
            );
        }
        
        function showStep(stepNumber) {
            // Ocultar todos los pasos
            document.querySelectorAll('.step').forEach(step => step.classList.add('hidden'));
            
            // Mostrar pasos hasta el actual
            for (let i = 1; i <= stepNumber; i++) {
                document.getElementById(`step${i}`).classList.remove('hidden');
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('Iniciando sistema de reservas...');
            loadServices();
        });
    </script>
</body>
</html>

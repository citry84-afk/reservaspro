<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario - ReservasPro</title>
    <link rel="stylesheet" href="../css/mobile-optimization.css">
    <script src="../js/multilanguage.js"></script>
    <script src="../js/common-header.js" defer></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui; background: #f8fafc; }
        .header { background: white; padding: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.25rem; font-weight: bold; color: #1e40af; text-decoration: none; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 8px; background: #059669; color: white; cursor: pointer; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding: 1rem; background: white; border-radius: 8px; }
        .calendar-nav button { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #1e40af; padding: 0.5rem; }
        .calendar-grid { display: grid; grid-template-columns: 100px repeat(7, 1fr); gap: 1px; background: #e2e8f0; border-radius: 8px; overflow: hidden; }
        .calendar-cell, .day-header, .time-slot { background: white; padding: 0.5rem; min-height: 60px; position: relative; }
        .day-header { background: #f8fafc; font-weight: bold; text-align: center; min-height: 40px; display: flex; align-items: center; justify-content: center; }
        .time-slot { background: #f8fafc; font-size: 0.875rem; display: flex; align-items: center; justify-content: center; }
        .calendar-cell { cursor: pointer; transition: background 0.2s; }
        .calendar-cell:hover { background: #eff6ff; }
        .appointment { background: #1e40af; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; margin: 1px 0; cursor: pointer; }
        .appointment.pending { background: #d97706; }
        .appointment.confirmed { background: #059669; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 2rem; border-radius: 12px; width: 90%; max-width: 500px; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
        .form-group input, .form-group select { width: 100%; padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 8px; }
    </style>
</head>
<body>
    
    
    <div class="container">
        <div class="calendar-header">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <button onclick="changeWeek(-1)">â€¹</button>
                <div id="currentWeek" style="font-weight: bold;">Semana Actual</div>
                <button onclick="changeWeek(1)">â€º</button>
            </div>
            <div style="display:flex; gap:0.5rem; align-items:center; flex-wrap: wrap;">
                <select id="viewMode" onchange="changeView()" style="border:1px solid #e2e8f0; border-radius:8px; padding:0.5rem;">
                    <option value="week" selected>Semanal</option>
                    <option value="day">Diaria</option>
                    <option value="month">Mensual</option>
                </select>
                <button class="btn" onclick="openModal()">âž• <span data-translate="btn.add">Agregar</span></button>
            </div>
        </div>
        
        <div class="calendar-grid" id="calendarGrid">
            <!-- Generated by JavaScript -->
        </div>
    </div>
    
    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h2> <span data-translate="btn.add">Agregar</span> Cita</h2>
            <form id="appointmentForm">
                <div class="form-group">
                    <label data-translate="form.client_name">Nombre del Cliente</label>
                    <input type="text" id="clientName" required>
                </div>
                <div class="form-group">
                    <label data-translate="form.service">Servicio</label>
                    <select id="service" required>
                        <option value="">Selecciona servicio</option>
                        <option value="corte">Corte - â‚¬15</option>
                        <option value="tinte">Tinte - â‚¬45</option>
                        <option value="mechas">Mechas - â‚¬65</option>
                    </select>
                </div>
                <div class="form-group">
                    <label data-translate="form.date">Fecha</label>
                    <input type="date" id="date" required>
                </div>
                <div class="form-group">
                    <label data-translate="form.time">Hora</label>
                    <select id="time" required>
                        <option value="">Selecciona hora</option>
                        <option value="09:00">09:00</option>
                        <option value="10:00">10:00</option>
                        <option value="11:00">11:00</option>
                        <option value="12:00">12:00</option>
                        <option value="15:00">15:00</option>
                        <option value="16:00">16:00</option>
                        <option value="17:00">17:00</option>
                    </select>
                </div>
                <div style="display: flex; gap: 1rem;">
                    <button type="submit" class="btn" style="flex: 1;" data-translate="btn.add">Agregar</button>
                    <button type="button" onclick="closeModal()" style="background: #64748b; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;" data-translate="btn.cancel">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        let currentWeekStart = new Date();
        let appointments = JSON.parse(localStorage.getItem('appointments') || '[]');
        
        // Sample data
        if (appointments.length === 0) {
            appointments = [
                { id: 1, client: 'Ana GarcÃ­a', service: 'Corte', date: new Date().toISOString().split('T')[0], time: '10:00', status: 'confirmed' },
                { id: 2, client: 'MarÃ­a JosÃ©', service: 'Tinte', date: new Date().toISOString().split('T')[0], time: '15:00', status: 'pending' }
            ];
            localStorage.setItem('appointments', JSON.stringify(appointments));
        }
        
        function generateCalendar() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            // Headers
            grid.appendChild(createCell('', 'day-header'));
            const days = ['Lun', 'Mar', 'MiÃ©', 'Jue', 'Vie', 'SÃ¡b', 'Dom'];
            days.forEach(day => grid.appendChild(createCell(day, 'day-header')));
            
            // Time slots
            for (let hour = 9; hour <= 17; hour++) {
                const timeStr = hour.toString().padStart(2, '0') + ':00';
                grid.appendChild(createCell(timeStr, 'time-slot'));
                
                for (let day = 0; day < 7; day++) {
                    const date = new Date(currentWeekStart);
                    date.setDate(currentWeekStart.getDate() + day);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    const cell = createCell('', 'calendar-cell');
                    cell.onclick = () => quickAdd(dateStr, timeStr);
                    
                    // Check for appointments
                    const apt = appointments.find(a => a.date === dateStr && a.time === timeStr);
                    if (apt) {
                        const aptDiv = document.createElement('div');
                        aptDiv.className = `appointment ${apt.status}`;
                        aptDiv.textContent = `${apt.service} - ${apt.client}`;
                        cell.appendChild(aptDiv);
                    }
                    
                    grid.appendChild(cell);
                }
            }
        }
        
        function createCell(content, className) {
            const cell = document.createElement('div');
            cell.className = className;
            cell.innerHTML = content;
            return cell;
        }
        
        function setCurrentWeek() {
            const now = new Date();
            const dayOfWeek = now.getDay();
            const mondayOffset = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
            currentWeekStart = new Date(now);
            currentWeekStart.setDate(now.getDate() + mondayOffset);
            
            const weekEnd = new Date(currentWeekStart);
            weekEnd.setDate(currentWeekStart.getDate() + 6);
            document.getElementById('currentWeek').textContent = 
                `${currentWeekStart.toLocaleDateString()} - ${weekEnd.toLocaleDateString()}`;
        }
        
        function changeWeek(direction) {
            currentWeekStart.setDate(currentWeekStart.getDate() + (direction * 7));
            setCurrentWeek();
            generateCalendar();
        }
        
        function quickAdd(date, time) {
            document.getElementById('date').value = date;
            document.getElementById('time').value = time;
            openModal();
        }
        
        function openModal() {
            document.getElementById('modal').classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }
        
        document.getElementById('appointmentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const appointment = {
                id: Date.now(),
                client: document.getElementById('clientName').value,
                service: document.getElementById('service').value,
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                status: 'confirmed'
            };
            
            appointments.push(appointment);
            localStorage.setItem('appointments', JSON.stringify(appointments));
            
            generateCalendar();
            closeModal();
            this.reset();
            
            alert('Â¡Cita creada exitosamente! ðŸŽ‰');
        });
        
        // Initialize
        setCurrentWeek();
        generateCalendar();
        
        // Close modal when clicking outside
        document.getElementById('modal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
    </script>
    <script>
        function changeView() {
            const mode = document.getElementById('viewMode').value;
            if (mode === 'week') {
                document.querySelector('.calendar-grid').style.gridTemplateColumns = '100px repeat(7, 1fr)';
                generateCalendar();
            } else if (mode === 'day') {
                document.querySelector('.calendar-grid').style.gridTemplateColumns = '100px 1fr';
                renderDayView();
            } else if (mode === 'month') {
                renderMonthView();
            }
        }

        function renderDayView() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            grid.appendChild(createCell('', 'day-header'));
            const today = new Date(currentWeekStart);
            grid.appendChild(createCell(today.toLocaleDateString('es-ES', { weekday: 'short', day: '2-digit' }), 'day-header'));
            for (let hour = 9; hour <= 17; hour++) {
                const timeStr = hour.toString().padStart(2, '0') + ':00';
                grid.appendChild(createCell(timeStr, 'time-slot'));
                const cell = createCell('', 'calendar-cell');
                const dateStr = today.toISOString().split('T')[0];
                const apt = appointments.find(a => a.date === dateStr && a.time === timeStr);
                if (apt) {
                    const aptDiv = document.createElement('div');
                    aptDiv.className = `appointment ${apt.status}`;
                    aptDiv.textContent = `${apt.service} - ${apt.client}`;
                    cell.appendChild(aptDiv);
                }
                cell.onclick = () => quickAdd(dateStr, timeStr);
                grid.appendChild(cell);
            }
        }

        function renderMonthView() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            // simple month grid: 7 columns x 6 rows
            const days = ['Lun','Mar','MiÃ©','Jue','Vie','SÃ¡b','Dom'];
            grid.style.gridTemplateColumns = 'repeat(7, 1fr)';
            days.forEach(d => grid.appendChild(createCell(d, 'day-header')));
            const firstDay = new Date(currentWeekStart);
            firstDay.setDate(1);
            const startOffset = (firstDay.getDay() + 6) % 7; // Monday-first
            const daysInMonth = new Date(firstDay.getFullYear(), firstDay.getMonth() + 1, 0).getDate();
            for (let i = 0; i < startOffset; i++) grid.appendChild(createCell('', 'calendar-cell'));
            for (let day = 1; day <= daysInMonth; day++) {
                const cell = createCell(String(day), 'calendar-cell');
                grid.appendChild(cell);
            }
        }
    </script>
</body>
</html>

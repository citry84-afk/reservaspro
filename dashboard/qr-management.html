<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de QR - ReservasPro</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui; background: #f8fafc; }
        .header { 
            background: white; 
            padding: 1rem; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .logo { font-size: 1.25rem; font-weight: bold; color: #1e40af; text-decoration: none; }
        .btn { 
            padding: 0.75rem 1.5rem; 
            border: none; 
            border-radius: 8px; 
            background: #1e40af; 
            color: white; 
            text-decoration: none; 
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn:hover { background: #1e3a8a; }
        .btn-secondary { background: #64748b; }
        .btn-success { background: #10b981; }
        .btn-success:hover { background: #059669; }
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .stats { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 1rem; 
            margin-bottom: 2rem; 
        }
        .stat-card { 
            background: white; 
            padding: 1.5rem; 
            border-radius: 12px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
        }
        .stat-title { color: #64748b; font-size: 0.875rem; margin-bottom: 0.5rem; }
        .stat-value { 
            font-size: 2rem; 
            font-weight: bold; 
            color: #1e40af; 
        }
        .stat-change { font-size: 0.875rem; color: #059669; margin-top: 0.5rem; }
        .qr-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 1.5rem; 
            margin-bottom: 2rem; 
        }
        .qr-card { 
            background: white; 
            padding: 1.5rem; 
            border-radius: 12px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
        }
        .qr-card h3 { color: #374151; margin-bottom: 1rem; }
        .qr-preview { 
            text-align: center; 
            padding: 1rem; 
            background: #f9fafb; 
            border-radius: 8px; 
            margin-bottom: 1rem; 
        }
        .qr-code { margin: 0.5rem 0; }
        .qr-actions { 
            display: flex; 
            gap: 0.5rem; 
            flex-wrap: wrap; 
        }
        .qr-info { 
            background: #eff6ff; 
            border: 1px solid #0ea5e9; 
            border-radius: 8px; 
            padding: 1rem; 
            margin-top: 1rem; 
        }
        .qr-info h4 { color: #0c4a6e; margin-bottom: 0.5rem; }
        .qr-info p { color: #1e40af; font-size: 0.875rem; margin-bottom: 0.25rem; }
        .quick-actions { 
            background: white; 
            padding: 1.5rem; 
            border-radius: 12px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
            margin-bottom: 2rem;
        }
        .actions { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 1rem; 
            margin-top: 1rem;
        }
        .action-btn { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 0.5rem; 
            padding: 1.5rem; 
            border: 2px dashed #e2e8f0; 
            border-radius: 12px; 
            text-decoration: none; 
            color: #64748b; 
            transition: all 0.2s;
        }
        .action-btn:hover { border-color: #1e40af; color: #1e40af; }
        .analytics { 
            background: white; 
            padding: 1.5rem; 
            border-radius: 12px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
        }
        .analytics h3 { color: #374151; margin-bottom: 1rem; }
        .chart-placeholder { 
            background: #f3f4f6; 
            border: 2px dashed #d1d5db; 
            border-radius: 8px; 
            padding: 2rem; 
            text-align: center; 
            color: #6b7280; 
        }
        @media (max-width: 768px) {
            .page-header { flex-direction: column; gap: 1rem; align-items: stretch; }
            .stats { grid-template-columns: 1fr; }
            .qr-grid { grid-template-columns: 1fr; }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>
    <header class="header">
        <a href="index.html" class="logo">üìÖ ReservasPro</a>
        <span style="color: #64748b;">Gesti√≥n de QR</span>
    </header>
    
    <div class="container">
        <div class="page-header">
            <h1>üì± Gesti√≥n de C√≥digos QR</h1>
            <a href="../qr-generator.html" class="btn btn-success">
                ‚ûï Crear Nuevo QR
            </a>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-title">QR Codes Activos</div>
                <div class="stat-value" id="activeQRCodes">3</div>
                <div class="stat-change">+1 esta semana</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Escaneos Totales</div>
                <div class="stat-value" id="totalScans">127</div>
                <div class="stat-change">+23 esta semana</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Conversi√≥n QR</div>
                <div class="stat-value">68%</div>
                <div class="stat-change">+5% vs anterior</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Reservas por QR</div>
                <div class="stat-value" id="qrBookings">86</div>
                <div class="stat-change">+12 esta semana</div>
            </div>
        </div>
        
        <div class="quick-actions">
            <h3>Acciones R√°pidas</h3>
            <div class="actions">
                <a href="../qr-generator.html" class="action-btn">
                    <span style="font-size: 2rem;">üéØ</span>
                    <span>Generar QR</span>
                </a>
                <a href="../qr-widget.html" class="action-btn">
                    <span style="font-size: 2rem;">üîó</span>
                    <span>Widget Web</span>
                </a>
                <a href="#" class="action-btn" onclick="printAllQRs()">
                    <span style="font-size: 2rem;">üñ®Ô∏è</span>
                    <span>Imprimir Todos</span>
                </a>
                <a href="#" class="action-btn" onclick="exportQRData()">
                    <span style="font-size: 2rem;">üìä</span>
                    <span>Exportar Datos</span>
                </a>
            </div>
        </div>
        
        <div class="qr-grid" id="qrGrid">
            <!-- QR Codes generados din√°micamente -->
        </div>
        
        <div class="analytics">
            <h3>üìä An√°lisis de QR Codes</h3>
            <div class="chart-placeholder">
                <h4>Gr√°fico de Escaneos por D√≠a</h4>
                <p>Los datos de analytics se mostrar√°n aqu√≠ cuando implementemos el tracking</p>
                <div style="margin-top: 1rem;">
                    <div style="display: flex; justify-content: space-around; margin-top: 1rem;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; color: #1e40af;">45</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">Lunes</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; color: #1e40af;">52</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">Martes</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; color: #1e40af;">38</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">Mi√©rcoles</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; color: #1e40af;">61</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">Jueves</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; color: #1e40af;">43</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">Viernes</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let qrCodes = [];
        
        function loadQRCodes() {
            // Cargar QR codes guardados en localStorage
            qrCodes = JSON.parse(localStorage.getItem('qrCodes') || '[]');
            
            // Si no hay QR codes, crear algunos de ejemplo
            if (qrCodes.length === 0) {
                createSampleQRCodes();
            }
            
            renderQRCodes();
            updateStats();
        }
        
        function createSampleQRCodes() {
            const businessName = localStorage.getItem('businessName') || 'Peluquer√≠a Mar√≠a';
            const bookingUrl = window.location.origin + '/booking.html';
            
            qrCodes = [
                {
                    id: 'qr_1',
                    name: 'QR Principal - Mostrador',
                    url: bookingUrl,
                    size: 'medium',
                    style: 'elegant',
                    scans: 45,
                    bookings: 32,
                    createdAt: new Date().toISOString(),
                    location: 'Mostrador principal'
                },
                {
                    id: 'qr_2',
                    name: 'QR Tarjetas de Visita',
                    url: bookingUrl,
                    size: 'small',
                    style: 'minimal',
                    scans: 28,
                    bookings: 19,
                    createdAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                    location: 'Tarjetas de visita'
                },
                {
                    id: 'qr_3',
                    name: 'QR Redes Sociales',
                    url: bookingUrl,
                    size: 'large',
                    style: 'colorful',
                    scans: 54,
                    bookings: 35,
                    createdAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                    location: 'Instagram/Facebook'
                }
            ];
            
            localStorage.setItem('qrCodes', JSON.stringify(qrCodes));
        }
        
        function renderQRCodes() {
            const grid = document.getElementById('qrGrid');
            grid.innerHTML = '';
            
            qrCodes.forEach(qr => {
                const card = document.createElement('div');
                card.className = 'qr-card';
                
                // Generar QR
                QRCode.toString(qr.url, {
                    type: 'svg',
                    width: getQRSize(qr.size),
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    }
                }, function (err, qrSvg) {
                    if (err) {
                        console.error('Error generando QR:', err);
                        return;
                    }
                    
                    card.innerHTML = `
                        <h3>${qr.name}</h3>
                        <div class="qr-preview">
                            <div class="qr-code">${qrSvg}</div>
                            <p style="color: #6b7280; font-size: 0.875rem;">${qr.location}</p>
                        </div>
                        <div class="qr-actions">
                            <button class="btn btn-secondary" onclick="downloadQR('${qr.id}')">üì• Descargar</button>
                            <button class="btn btn-secondary" onclick="printQR('${qr.id}')">üñ®Ô∏è Imprimir</button>
                            <button class="btn btn-secondary" onclick="copyQRUrl('${qr.id}')">üìã Copiar URL</button>
                            <button class="btn btn-secondary" onclick="deleteQR('${qr.id}')">üóëÔ∏è Eliminar</button>
                        </div>
                        <div class="qr-info">
                            <h4>üìä Estad√≠sticas</h4>
                            <p><strong>Escaneos:</strong> ${qr.scans}</p>
                            <p><strong>Reservas:</strong> ${qr.bookings}</p>
                            <p><strong>Conversi√≥n:</strong> ${Math.round((qr.bookings / qr.scans) * 100)}%</p>
                            <p><strong>Creado:</strong> ${new Date(qr.createdAt).toLocaleDateString('es-ES')}</p>
                        </div>
                    `;
                });
                
                grid.appendChild(card);
            });
        }
        
        function getQRSize(size) {
            switch(size) {
                case 'small': return 120;
                case 'medium': return 180;
                case 'large': return 240;
                default: return 180;
            }
        }
        
        function downloadQR(qrId) {
            const qr = qrCodes.find(q => q.id === qrId);
            if (!qr) return;
            
            QRCode.toCanvas(document.createElement('canvas'), qr.url, {
                width: getQRSize(qr.size) * 2,
                color: {
                    dark: '#000000',
                    light: '#FFFFFF'
                }
            }, function (err, canvas) {
                if (err) {
                    console.error('Error generando QR:', err);
                    return;
                }
                
                const link = document.createElement('a');
                link.download = `${qr.name.replace(/\s+/g, '_')}_QR.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }
        
        function printQR(qrId) {
            const qr = qrCodes.find(q => q.id === qrId);
            if (!qr) return;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Imprimir QR - ${qr.name}</title>
                        <style>
                            body { font-family: system-ui; text-align: center; padding: 2rem; }
                            .qr-container { margin: 2rem 0; }
                            .qr-info { margin-top: 1rem; color: #6b7280; }
                        </style>
                    </head>
                    <body>
                        <h2>${qr.name}</h2>
                        <div class="qr-container" id="qrContainer"></div>
                        <div class="qr-info">
                            <p>Escanea para reservar tu cita</p>
                            <p>${qr.url}</p>
                        </div>
                    </body>
                </html>
            `);
            
            QRCode.toString(qr.url, {
                type: 'svg',
                width: 300,
                color: {
                    dark: '#000000',
                    light: '#FFFFFF'
                }
            }, function (err, qrSvg) {
                if (err) {
                    console.error('Error generando QR:', err);
                    return;
                }
                
                printWindow.document.getElementById('qrContainer').innerHTML = qrSvg;
                printWindow.document.close();
                printWindow.print();
            });
        }
        
        function copyQRUrl(qrId) {
            const qr = qrCodes.find(q => q.id === qrId);
            if (!qr) return;
            
            navigator.clipboard.writeText(qr.url).then(() => {
                alert('URL copiada al portapapeles');
            }).catch(err => {
                console.error('Error copiando URL:', err);
                alert('Error copiando URL');
            });
        }
        
        function deleteQR(qrId) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este QR?')) {
                qrCodes = qrCodes.filter(q => q.id !== qrId);
                localStorage.setItem('qrCodes', JSON.stringify(qrCodes));
                renderQRCodes();
                updateStats();
            }
        }
        
        function printAllQRs() {
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Imprimir Todos los QR Codes</title>
                        <style>
                            body { font-family: system-ui; padding: 2rem; }
                            .qr-page { page-break-after: always; text-align: center; margin-bottom: 2rem; }
                            .qr-page:last-child { page-break-after: avoid; }
                            .qr-container { margin: 1rem 0; }
                            .qr-info { margin-top: 1rem; color: #6b7280; }
                        </style>
                    </head>
                    <body>
                        <div id="qrPages"></div>
                    </body>
                </html>
            `);
            
            let qrCount = 0;
            qrCodes.forEach(qr => {
                QRCode.toString(qr.url, {
                    type: 'svg',
                    width: 200,
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    }
                }, function (err, qrSvg) {
                    if (err) {
                        console.error('Error generando QR:', err);
                        return;
                    }
                    
                    const qrPage = document.createElement('div');
                    qrPage.className = 'qr-page';
                    qrPage.innerHTML = `
                        <h3>${qr.name}</h3>
                        <div class="qr-container">${qrSvg}</div>
                        <div class="qr-info">
                            <p>Escanea para reservar tu cita</p>
                            <p>${qr.location}</p>
                        </div>
                    `;
                    
                    printWindow.document.getElementById('qrPages').appendChild(qrPage);
                    qrCount++;
                    
                    if (qrCount === qrCodes.length) {
                        printWindow.document.close();
                        printWindow.print();
                    }
                });
            });
        }
        
        function exportQRData() {
            const data = {
                qrCodes: qrCodes,
                exportDate: new Date().toISOString(),
                totalQRCodes: qrCodes.length,
                totalScans: qrCodes.reduce((sum, qr) => sum + qr.scans, 0),
                totalBookings: qrCodes.reduce((sum, qr) => sum + qr.bookings, 0)
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.download = `qr_codes_export_${new Date().toISOString().split('T')[0]}.json`;
            link.href = url;
            link.click();
            URL.revokeObjectURL(url);
        }
        
        function updateStats() {
            const totalScans = qrCodes.reduce((sum, qr) => sum + qr.scans, 0);
            const totalBookings = qrCodes.reduce((sum, qr) => sum + qr.bookings, 0);
            
            document.getElementById('activeQRCodes').textContent = qrCodes.length;
            document.getElementById('totalScans').textContent = totalScans;
            document.getElementById('qrBookings').textContent = totalBookings;
        }
        
        // Cargar datos al iniciar
        document.addEventListener('DOMContentLoaded', function() {
            loadQRCodes();
        });
    </script>
</body>
</html>
